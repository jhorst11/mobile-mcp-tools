# QR Code Login for Android

To configure QR code login for an Android app, follow these steps.

## Create An App by Using AndroidNativeKotlinTemplate

The `AndroidNativeKotlinTemplate` includes sample code for setting up QR code login. Find `AndroidNativeKotlinTemplate` in Mobile SDK’s GitHub repository, [github.com/forcedotcom/SalesforceMobileSDK-Templates](https://github.com/forcedotcom/SalesforceMobileSDK-Templates).

To create an app by using the template, see [Creating an Android Project with Forcedroid](https://developer.salesforce.com/docs/platform/mobile-sdk/guide/android-new-project.html).


## Enable App QR Code Login Features

In `AndroidNativeKotlinTemplate`, QR code login features are labeled by this comment: “Log in via Salesforce UI Bridge API generated QR codes.”

To enable QR code login features in `AndroidNativeKotlinTemplate`, modify these files.

### app/src/main/AndroidManifest.xml

1. To allow the app to receive QR code URLs scanned by other apps as deep linked intents, go to `AndroidManifest.xml` and uncomment the app’s `MainActivity` intent-filter.
2. Customize the scheme attribute to match the app’s expected QR code login URLs.

  :::note
  If your app uses an Android link specification other than deep links, the configuration varies. See Android’s reference documentation, [Handling Android App Links](https://developer.android.com/training/app-links).
  :::

```
  <!-- Uncomment when enabling login via UI Bridge API-generated QR codes -->

  <!-- This declares the app’s support for QR code login deep links.  
  The scheme can be customized by the app to match any scheme 
  used in the QR Code’s URL -->

  <!--<intent-filter>-->
  <!--<data android:scheme="mobileapp" />-->
  <!--<action android:name="android.intent.action.VIEW" />-->

  <!--<category android:name="android.intent.category.BROWSABLE" />-->

  <!--<category android:name="android.intent.category.DEFAULT" />-->
  <!--</intent-filter>-->
```

3. To provide a button for QR code login and implement the logic to scan a QR code, uncomment `QrCodeEnabledLoginActivity`, and then specify it as the activity class. Optionally, you can customize your own activity class as long as it can receive the URL and provide the UI Bridge API frontdoor URL and optional code verifier to Mobile SDK.

  
  ```
  <!-- Use `android:name="com.salesforce.androidnativekotlintemplate.QrCodeEnabledLoginActivity"`
  when enabling log in via Salesforce UI Bridge API generated QR codes -->
  <!--<activity-->
  <!--android:name="com.salesforce.androidsdk.ui.LoginActivity"-->
  <!--android:exported="true"-->
  <!--android:launchMode="singleTask"-->
  <!--android:theme="@style/SalesforceSDK" />-->
  ```

### app/src/main/java/com/salesforce/androidnativekotlintemplate/MainActivity.kt

To customize the QR code login’s URL format, use the sample code provided in `MainActivity.kt`.

When using a QR code login URL generated by the UI Bridge API, you can choose between Mobile SDK’s reference format or a custom format.


```
internal  var  isQrCodeLoginUsingReferenceUrlFormat  =  true

```

If you’re using our reference format, make sure to fill in these variables.

```
internal var qrCodeLoginUrlScheme = "YOUR_QR_CODE_LOGIN_URL_SCHEME"
internal var qrCodeLoginUrlHost = "YOUR_QR_CODE_LOGIN_URL_HOST"
```

If you’re using a custom format, set `isQrCodeLoginUsingReferenceUrlFormat` to `false`, and then provide the URL handling logic in `MainActivity.useQrCodeLogInUrl(url)`.

The `onResume()`function calls `setupQrCodeLogin()` to set up QR Code Login. When the intent has data for deep linked QR code login URLs, `onResume()` calls `useQrCodeLogInUrl()`. If you choose to implement a custom QR code login URL format, you can configure the app to receive the URLs in the `onResume()` function and pass them to useQrCodeLogInUrl(). You can also customize the way useQrCodeLogInUrl() or another custom method retrieves the UI Bridge API’s frontdoor URL and optional code verifier.

For finer details on URL parsing, schemes, and structure, see the in-code comments in `MainActivity.kt`.

```
override fun onResume() {
        ...

        // Check for and use the intent’s QR code login URL if applicable.
        // Uncomment when enabling login via Salesforce UI Bridge API generated QR codes
        //intent.data?.let { useQrCodeLogInUrl(it) }

        ...

        /* Uncomment when enabling log in via Salesforce UI Bridge API generated QR codes. */
        //setupQrCodeLogin()

        ...

    // Region QR Code Login Via Salesforce Identity API UI Bridge Private Implementation

    /**
     * Sets up QR code login.
     */
    private fun setupQrCodeLogin() {
      // The scheme and host for the expected QR code log in URL format.
      check(qrCodeLoginUrlScheme != "your-qr-code-login-url-scheme") 
      { "Please add your login QR code URL's scheme." }

      check(qrCodeLoginUrlHost != "your-qr-code-login-url-host") 
      { "Please add your login QR code URL's host." }

      // The path, parameter names, and JSON keys for the expected QR code log in URL format.
      qrCodeLoginUrlPath = "your-qr-code-login-url-path"

      qrCodeLoginUrlJsonParameterName = "your-qr-code-login-url-json-parameter-name"
      
      qrCodeLoginUrlJsonFrontdoorBridgeUrlKey = 
      "your-qr-code-login-url-json-frontdoor-bridge-url-key"

      qrCodeLoginUrlJsonPkceCodeVerifierKey = 
      "your-qr-code-login-url-json-pkce-code-verifier-key"

      check(qrCodeLoginUrlPath != "your-qr-code-login-url-path") 
      { "Please add your login QR code URL's path." }

      check(qrCodeLoginUrlJsonParameterName != "your-qr-code-login-url-json-parameter-name") 
      { "Please add your login QR code URL's UI Bridge API JSON query string parameter name." }
      
      check(qrCodeLoginUrlJsonFrontdoorBridgeUrlKey != 
      "your-qr-code-login-url-json-frontdoor-bridge-url-key") 
      { "Please add your login QR code URL's UI Bridge API JSON frontdoor bridge URL key." }
      
      check(qrCodeLoginUrlJsonPkceCodeVerifierKey != 
      "your-qr-code-login-url-json-pkce-code-verifier-key") 
      { "Please add your login QR code URL's UI Bridge API JSON PKCE code verifier key." }
    }

    ...

}    

    // Endregion
```